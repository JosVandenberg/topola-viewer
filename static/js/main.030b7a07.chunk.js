(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{246:function(e){e.exports={"menu.load_from_url":"Otw\xf3rz URL","menu.load_from_file":"Otw\xf3rz plik","menu.print":"Drukuj","menu.download":"Pobierz","menu.pdf_file":"Plik PDF","menu.png_file":"Plik PNG","menu.svg_file":"Plik SVG","menu.github":"\u0179r\xf3d\u0142a na GitHub","menu.search.placeholder":"Szukaj osoby","menu.search.no_results":"Brak wynik\xf3w","intro.title":"Topola Genealogy","intro.description":"Topola Genealogy pozwala przegl\u0105da\u0107 drzewo genealogiczne w interaktywny spos\xf3b.","intro.instructions":"Kliknij OTW\xd3RZ URL lub OTW\xd3RZ PLIK, aby za\u0142adowa\u0107 plik GEDCOM. Wi\u0119kszo\u015b\u0107 program\xf3w genealogicznych posiada funkcj\u0119 eksportu do pliku GEDCOM.","intro.examples":"Poni\u017cej jest kilka przyk\u0142ad\xf3w znalezionych w Internecie:","intro.from":"\u017ar\xf3d\u0142o:","intro.privacy":"Prywatno\u015b\u0107","intro.privacy_note":'U\u017cywaj\u0105c funkcji "Otw\xf3rz plik", Twoje dane nie s\u0105 nigdzie wysy\u0142ane i pozostaj\u0105 na Twoim komputerze. U\u017cywaj\u0105c funkcji "Otw\xf3rz URL", dane z podanego adresu przesy\u0142ane s\u0105 przez us\u0142ug\u0119 {link} w celu umo\u017cliwienia za\u0142adowania danych z innej domeny (CORS).',"load_from_url.title":"Otw\xf3rz z adresu URL","load_from_url.comment":"Dane z podanego adresu URL zostan\u0105 za\u0142adowane poprzez us\u0142ug\u0119 {link} w celu unikni\u0119cia problem\xf3w z CORS.","load_from_url.cancel":"Anuluj","load_from_url.load":"Otw\xf3rz","gedcom.BAPM":"Chrzest","gedcom.BIRT":"Narodziny","gedcom.BURI":"Pogrzeb","gedcom.CHR":"Chrzest","gedcom.DEAT":"\u015amier\u0107","gedcom.EMAIL":"E-mail","gedcom.OCCU":"Zaw\xf3d","gedcom.TITL":"Tytu\u0142","gedcom.WWW":"Strona WWW","date.abt":"oko\u0142o","date.cal":"wyliczone","date.est":"oszacowane","date.between":"mi\u0119dzy {from} a {to}","date.after":"po {from}","date.before":"przed {to}"}},247:function(e,t){},289:function(e,t,n){e.exports=n(513)},301:function(e,t){},307:function(e,t){},510:function(e,t,n){},513:function(e,t,n){"use strict";n.r(t);var a=n(74),r=n(244),o=n(245),i=n(0),l=n(62),c=n(246),s=n(15),u=n(17),d=n.n(u),f=n(26),m=n(29),h=n(30),p=n(37),g=n(34),v=n(36),w=n(42);function E(e,t){window.gtag("event",e,t)}var y=n(21),b=n(249),O=n.n(b),k=n(159),x=n(50);function j(){var e=y.select("#chart").node().parentElement;e.scrollLeft=-y.event.transform.x,e.scrollTop=-y.event.transform.y}function R(){var e=y.select("#chart").node().parentElement,t=e.scrollLeft+e.clientWidth/2,n=e.scrollTop+e.clientHeight/2;y.select(e).call(y.zoom().translateTo,t,n)}function C(e){var t=new FileReader;return t.readAsDataURL(e),new Promise(function(e,n){t.onload=function(t){return e(t.target.result)}})}function S(e){return M.apply(this,arguments)}function M(){return(M=Object(f.a)(d.a.mark(function e(t){var n,a,r,o;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.href.baseVal){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,fetch(n);case 6:return a=e.sent,e.next=9,a.blob();case 9:return r=e.sent,e.next=12,C(r);case 12:o=e.sent,t.href.baseVal=o,e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),console.warn("Failed to load image:",e.t0);case 19:case"end":return e.stop()}},e,null,[[3,16]])}))).apply(this,arguments)}function z(e){return _.apply(this,arguments)}function _(){return(_=Object(f.a)(d.a.mark(function e(t){var n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Array.from(t.getElementsByTagName("image")),e.next=3,Promise.all(n.map(S));case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function D(e){var t=new Image;return t.src=URL.createObjectURL(e),new Promise(function(e,n){t.addEventListener("load",function(){return e(t)})})}function T(e){var t=document.createElement("canvas");t.width=2*e.width,t.height=2*e.height;var n=t.getContext("2d"),a=n.fillStyle;return n.fillStyle="white",n.fillRect(0,0,t.width,t.height),n.fillStyle=a,n.drawImage(e,0,0,t.width,t.height),t}function I(e,t){return new Promise(function(n,a){e.toBlob(function(e){e?n(e):a()},t)})}var L=function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).chart=void 0,n}return Object(v.a)(t,e),Object(h.a)(t,[{key:"renderChart",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{initialRender:!1};t.initialRender&&(y.select("#chart").node().innerHTML="",this.chart=Object(x.createChart)({json:this.props.data,chartType:x.HourglassChart,renderer:x.DetailedRenderer,svgSelector:"#chart",indiCallback:function(t){return e.props.onSelection(t)},animate:!0,updateSvgSize:!1,locale:this.context.intl.locale}));var n=this.chart.render({startIndi:this.props.selection.id,baseGeneration:this.props.selection.generation}),a=y.select("#chart"),r=a.node().parentElement;y.select(r).on("scroll",R).call(y.zoom().scaleExtent([1,1]).translateExtent([[0,0],n.size]).on("zoom",j));var o,i,l=r.clientWidth/2-n.origin[0],c=r.clientHeight/2-n.origin[1],s=y.max([0,(r.clientWidth-n.size[0])/2]),u=y.max([0,(r.clientHeight-n.size[1])/2]),d=a.transition().delay(200).duration(500);(t.initialRender?a:d).attr("transform","translate(".concat(s,", ").concat(u,")")).attr("width",n.size[0]).attr("height",n.size[1]),t.initialRender?(r.scrollLeft=-l,r.scrollTop=-c):d.tween("scrollLeft",(i=-l,function(){var e=y.interpolateNumber(r.scrollLeft,i);return function(t){r.scrollLeft=e(t)}})).tween("scrollTop",(o=-c,function(){var e=y.interpolateNumber(r.scrollTop,o);return function(t){r.scrollTop=e(t)}}))}},{key:"componentDidMount",value:function(){this.renderChart({initialRender:!0})}},{key:"componentDidUpdate",value:function(e){this.renderChart({initialRender:this.props.data!==e.data})}},{key:"render",value:function(){return i.createElement("div",{id:"svgContainer"},i.createElement("svg",{id:"chart"}))}},{key:"getSvgContents",value:function(){var e=document.getElementById("chart").cloneNode(!0);return e.removeAttribute("transform"),(new XMLSerializer).serializeToString(e)}},{key:"getSvgContentsWithInlinedImages",value:function(){var e=Object(f.a)(d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=document.getElementById("chart").cloneNode(!0)).removeAttribute("transform"),e.next=4,z(t);case 4:return e.abrupt("return",(new XMLSerializer).serializeToString(t));case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"print",value:function(){var e=this,t=document.createElement("iframe");t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.onload=function(){t.contentDocument.open(),t.contentDocument.write(e.getSvgContents()),t.contentDocument.close(),setTimeout(function(){t.contentWindow.focus(),t.contentWindow.print(),t.parentNode.removeChild(t)},500)},document.body.appendChild(t)}},{key:"downloadSvg",value:function(){var e=Object(f.a)(d.a.mark(function e(){var t,n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSvgContentsWithInlinedImages();case 2:t=e.sent,n=new Blob([t],{type:"image/svg+xml"}),Object(k.saveAs)(n,"topola.svg");case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"drawOnCanvas",value:function(){var e=Object(f.a)(d.a.mark(function e(){var t,n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSvgContentsWithInlinedImages();case 2:return t=e.sent,n=new Blob([t],{type:"image/svg+xml"}),e.t0=T,e.next=7,D(n);case 7:return e.t1=e.sent,e.next=10,(0,e.t0)(e.t1);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"downloadPng",value:function(){var e=Object(f.a)(d.a.mark(function e(){var t,n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.drawOnCanvas();case 2:return t=e.sent,e.next=5,I(t,"image/png");case 5:n=e.sent,Object(k.saveAs)(n,"topola.png");case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"downloadPdf",value:function(){var e=Object(f.a)(d.a.mark(function e(){var t,n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.drawOnCanvas();case 2:t=e.sent,(n=new O.a({orientation:t.width>t.height?"l":"p",unit:"pt",format:[t.width,t.height]})).addImage(t,"PNG",0,0,t.width,t.height,"NONE"),n.save("topola.pdf");case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),t}(i.PureComponent);L.contextTypes={intl:s.d};var N=n(251),U=n.n(N),P=n(252),A=n.n(P),W=new Map([["abt","about"],["cal","calculated"],["est","estimated"]]);function F(e,t){var n=void 0!==e.day,a=void 0!==e.month,r=void 0!==e.year;if(!n&&!a&&!r)return e.text||"";var o=new Date(r?e.year:0,a?e.month-1:0,n?e.day:1),i=e.qualifier&&e.qualifier.toLowerCase(),l={day:n?"numeric":void 0,month:a?"long":void 0,year:r?"numeric":void 0};return[i&&t.formatMessage({id:"date.".concat(i),defaultMessage:W.get(i)||i}),new Intl.DateTimeFormat(t.locale,l).format(o)].join(" ")}function B(e,t){var n=Object(x.getDate)(e);return n?n.date?F(n.date,t):n.dateRange?function(e,t){var n=e.from,a=e.to,r=n&&F(n,t),o=a&&F(a,t);return r&&o?t.formatMessage({id:"date.between",defaultMessage:"between {from} and {to}"},{from:r,to:o}):r?t.formatMessage({id:"date.after",defaultMessage:"after {from}"},{from:r}):o?t.formatMessage({id:"date.before",defaultMessage:"before {to}"},{to:o}):""}(n.dateRange,t):"":""}var G=["BIRT","BAPM","CHR","DEAT","BURI"],H=["NAME","SEX","FAMC","FAMS","SOUR","NOTE"],V=new Map([["BAPM","Baptism"],["BIRT","Birth"],["BURI","Burial"],["CHR","Christening"],["DEAT","Death"],["EMAIL","E-mail"],["OCCU","Occupation"],["TITL","Title"],["WWW","WWW"]]);function J(e){return i.createElement(s.a,{id:"gedcom.".concat(e),defaultMessage:V.get(e)||e})}function q(e){return i.createElement(i.Fragment,null,e.map(function(e){return i.createElement(i.Fragment,null,i.createElement(A.a,{properties:{target:"_blank"}},e),i.createElement("br",null))}))}function K(e){var t=[e.data];return e.tree.forEach(function(e){if("CONC"===e.tag&&e.data){var n=t.length-1;t[n]+=e.data}else"CONT"===e.tag&&e.data&&t.push(e.data)}),t}function X(e){return q(K(e).map(function(e){return i.createElement("i",null,e)}))}function Z(e){return i.createElement("h2",{className:"ui header"},e.data.split("/").filter(function(e){return!!e}).map(function(e){return i.createElement(i.Fragment,null,e,i.createElement("br",null))}))}function Y(e,t,n){return U()(t,function(t){return e.filter(function(e){return e.tag===t}).map(function(e){return n(e)})}).filter(function(e){return null!==e}).map(function(e){return i.createElement("div",{className:"ui segment"},e)})}function $(e){return e.filter(function(e){return!H.includes(e.tag)&&!G.includes(e.tag)}).map(function(e){return function(e){var t=[];return e.data&&t.push.apply(t,Object(a.a)(K(e))),e.tree.filter(function(e){return"NOTE"===e.tag}).forEach(function(e){return K(e).forEach(function(e){return t.push(i.createElement("i",null,e))})}),t.length?i.createElement(i.Fragment,null,i.createElement("div",{className:"ui sub header"},J(e.tag)),i.createElement("span",null,q(t))):null}(e)}).filter(function(e){return null!==e}).map(function(e){return i.createElement("div",{className:"ui segment"},e)})}var Q=function(e){function t(){return Object(m.a)(this,t),Object(p.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this,t=this.props.gedcom.indis[this.props.indi].tree;return i.createElement("div",{className:"ui segments",id:"details"},Y(t,["NAME"],Z),Y(t,G,function(t){return function(e,t){var n=[],r=e.tree.find(function(e){return"DATE"===e.tag});r&&r.data&&n.push(B(r.data,t));var o=e.tree.find(function(e){return"PLAC"===e.tag});return o&&o.data&&n.push.apply(n,Object(a.a)(K(o))),e.tree.filter(function(e){return"NOTE"===e.tag}).forEach(function(e){return K(e).forEach(function(e){return n.push(i.createElement("i",null,e))})}),n.length?i.createElement(i.Fragment,null,i.createElement("div",{className:"ui sub header"},J(e.tag)),i.createElement("span",null,q(n))):null}(t,e.context.intl)}),$(t),Y(t,["NOTE"],X))}}]),t}(i.Component);Q.contextTypes={intl:s.d};var ee=n(155);function te(e){return e.substring(1,e.length-1)}function ne(e){var t=e.find(function(e){return"HEAD"===e.tag}),n={},a={};return e.forEach(function(e){"INDI"===e.tag?n[te(e.pointer)]=e:"FAM"===e.tag&&(a[te(e.pointer)]=e)}),{head:t,indis:n,fams:a}}function ae(e){var t=function(e){var t=new Map;return e.indis.forEach(function(e){t[e.id]=e}),function(e,n){var a,r,o=(a=e)<(r=n)?-1:a>r?1:0,i=t[e],l=t[n],c=i&&i.birth,s=l&&l.birth,u=c&&(c.date||c.dateRange&&c.dateRange.from),d=s&&(s.date||s.dateRange&&s.dateRange.from);return u&&u.year&&d&&d.year?u.year!==d.year?u.year-d.year:u.month&&d.month?u.month!==d.month?u.month-d.month:u.day&&d.day&&u.day!==d.day?u.month-d.month:o:o:o}}(e),n=e.fams.map(function(e){return function(e,t){if(!e.children)return e;var n=e.children.sort(t);return Object.assign({},e,{children:n})}(e,t)});return Object.assign({},e,{fams:n})}function re(e,t){var n=e.indis.map(function(e){return function(e,t){if(e.imageUrl){var n=e.imageUrl.match(/[^\/\\]*$/)[0];if(t.has(n)){var a=Object.assign({},e);return a.imageUrl=t.get(n),a}}if(!e.imageUrl||e.imageUrl.startsWith("http"))return e;var r=Object.assign({},e);return delete r.imageUrl,r}(e,t)});return Object.assign({},e,{indis:n})}function oe(e){var t=e&&e.tree&&e.tree.find(function(e){return"SOUR"===e.tag}),n=t&&t.tree&&t.tree.find(function(e){return"NAME"===e.tag});return n&&n.data||null}function ie(e,t,n){return{id:t||e.indis[0].id,generation:n||0}}function le(e,t,n){var a=function(e,t){var n=Object(ee.parse)(e),a=Object(x.gedcomEntriesToJson)(n);if(!a||!a.indis||!a.indis.length||!a.fams||!a.fams.length)throw new Error("Failed to read GEDCOM file");return{chartData:re(ae(a),t),gedcom:ne(n)}}(e,n||new Map),r=JSON.stringify(a);try{sessionStorage.setItem(t,r)}catch(o){console.warn("Failed to store data in session storage: "+o)}return a}function ce(e,t){return se.apply(this,arguments)}function se(){return(se=Object(f.a)(d.a.mark(function e(t,n){var a,r,o,i;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=sessionStorage.getItem(t))){e.next=3;break}return e.abrupt("return",JSON.parse(a));case 3:return r=n?"https://cors-anywhere.herokuapp.com/"+t:t,e.next=6,window.fetch(r);case 6:if(200===(o=e.sent).status){e.next=9;break}throw new Error(o.statusText);case 9:return e.next=11,o.text();case 11:return i=e.sent,e.abrupt("return",le(i,t));case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ue(e,t,n){return de.apply(this,arguments)}function de(){return(de=Object(f.a)(d.a.mark(function e(t,n,a){var r;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=sessionStorage.getItem(t))){e.next=3;break}return e.abrupt("return",JSON.parse(r));case 3:if(n){e.next=5;break}throw new Error("Error loading data. Please upload your file again.");case 5:return e.abrupt("return",le(n,t,a));case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}var fe=n(529),me=n(522);function he(e){return i.createElement(me.a,{to:{pathname:"/view",search:w.stringify({url:e.url})}},e.text)}function pe(){return i.createElement(fe.a,{className:"intro"},i.createElement(fe.a.Content,null,i.createElement(fe.a.Header,null,i.createElement(s.a,{id:"intro.title",defaultMessage:"Topola Genealogy Viewer"}))),i.createElement(fe.a.Content,null,i.createElement("p",null,i.createElement(s.a,{id:"intro.description",defaultMessage:"Topola Genealogy is a genealogy tree viewer that lets you browse the structure of the family."})),i.createElement("p",null,i.createElement(s.a,{id:"intro.instructions",defaultMessage:"Use the LOAD FROM URL or LOAD FROM FILE buttons above to load a GEDCOM file. You can export a GEDCOM file from most of the existing genealogy programs and web sites."})),i.createElement("p",null,i.createElement(s.a,{id:"intro.examples",defaultMessage:"Here are some examples from the web that you can view:"})),i.createElement("ul",null,i.createElement("li",null,i.createElement(he,{url:"http://genpol.com/module-Downloads-prep_hand_out-lid-32.html",text:"Karol Wojty\u0142a"})," ","(",i.createElement(s.a,{id:"intro.from",defaultMessage:"from"})," ",i.createElement("a",{href:"http://genpol.com/module-Downloads-display-lid-32.html"},"GENPOL"),")"),i.createElement("li",null,i.createElement(he,{url:"https://webtreeprint.com/tp_downloader.php?path=famous_gedcoms/shakespeare.ged",text:"Shakespeare"})," ","(",i.createElement(s.a,{id:"intro.from",defaultMessage:"from"})," ",i.createElement("a",{href:"https://webtreeprint.com/tp_famous_gedcoms.php"},"webtreeprint.com"),")"),i.createElement("li",null,i.createElement(he,{url:"http://genealogyoflife.com/tng/gedcom/HarryPotter.ged",text:"Harry Potter"})," ","(",i.createElement(s.a,{id:"intro.from",defaultMessage:"from"})," ",i.createElement("a",{href:"http://famousfamilytrees.blogspot.com/"},"Famous Family Trees"),")")),i.createElement("p",null,i.createElement("b",null,i.createElement(s.a,{id:"intro.privacy",defaultMessage:"Privacy"})),":",i.createElement(s.a,{id:"intro.privacy_note",defaultMessage:'When using the "load from file" option, this site does not send your data anywhere and files loaded from disk do not leave your computer. When using "load from URL", data is passed through the {link} service to deal with an issue with cross-site file loading in the browser (CORS).',values:{link:i.createElement("a",{href:"https://cors-anywhere.herokuapp.com/"},"cors-anywhere")}}))))}var ge=n(530),ve=n(537),we=n(525),Ee=n(539),ye=n(536),be=n(533),Oe=n(257),ke=n.n(Oe),xe=n(160),je=n.n(xe),Re=n(258),Ce=n.n(Re),Se=n(259),Me=n.n(Se);function ze(e,t){return e.score!==t.score?e.score-t.score:Ce()(e.ref,t.ref)}var _e=function(){function e(t){Object(m.a)(this,e),this.gedcom=t,this.index=void 0,this.index=Me()(function(){for(var e in this.ref("id"),this.field("id"),this.field("name"),this.field("normalizedName"),t.indis){var n=t.indis[e].tree.filter(function(e){return"NAME"===e.tag}).map(function(e){return e.data}).join(" ");this.add({id:e,name:n,normalizedName:(a=n,a.toLocaleLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\u0142/g,"l"))})}var a})}return Object(h.a)(e,[{key:"search",value:function(e){var t=this,n=e.split(" ").filter(function(e){return!!e}).map(function(e){return"+".concat(e,"*")}).join(" ");return this.index.search(n).sort(ze).slice(0,8).map(function(e){return{id:e.ref,indi:t.gedcom.indis[e.ref]}})}}]),e}();function De(e){var t=e.indi.tree.find(function(e){return"NAME"===e.tag}),n=t&&t.data.split("/").filter(function(e){return!!e}).join(" ");return e.id.length>8?n:i.createElement(i.Fragment,null,n," ",i.createElement("i",null,"(",e.id,")"))}function Te(e,t,n){var a=e.tree.find(function(e){return e.tag===t}),r=a&&a.tree.find(function(e){return"DATE"===e.tag});return r&&B(r.data,n)||""}function Ie(e,t){var n=Te(e,"BIRT",t),a=Te(e,"DEAT",t);return a?"".concat(n," \u2013 ").concat(a):n}var Le=n(527),Ne=n(535),Ue=n(63),Pe=n(526),Ae=n(524),We=n(515),Fe=n(531),Be=n(528),Ge=n(532);function He(e){return new Promise(function(t,n){var a=new FileReader;a.onload=function(e){t(e.target.result)},a.readAsText(e)})}function Ve(e){var t=e.toLowerCase();return t.endsWith(".jpg")||t.endsWith(".png")}var Je=function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={loadUrlDialogOpen:!1,searchResults:[]},n.inputRef=void 0,n.searchRef=void 0,n.searchIndex=void 0,n}return Object(v.a)(t,e),Object(h.a)(t,[{key:"handleUpload",value:function(){var e=Object(f.a)(d.a.mark(function e(t){var n,a,r,o,i,l,c,s;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((n=t.target.files)&&n.length){e.next=3;break}return e.abrupt("return");case 3:return a=Array.from(n),t.target.value="",E("upload_files_selected",{event_value:n.length}),r=1===n.length?n[0]:a.find(function(e){return e.name.toLowerCase().endsWith(".ged")})||n[0],o=a.filter(function(e){return e.name!==r.name&&Ve(e.name)}).map(function(e){return{name:e.name,url:URL.createObjectURL(e)}}),i=new Map(o.map(function(e){return[e.name,e.url]})),e.next=11,He(r);case 11:l=e.sent,c=o.map(function(e){return e.name}).sort().join("|"),s=je()(je()(l)+c),this.props.history.push({pathname:"/view",search:w.stringify({file:s}),state:{data:l,images:i}});case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"handleLoadFromUrl",value:function(){var e=this;this.setState(Object.assign({},this.state,{loadUrlDialogOpen:!0}),function(){return e.inputRef.focus()})}},{key:"handleClose",value:function(){this.setState(Object.assign({},this.state,{loadUrlDialogOpen:!1}))}},{key:"handleLoad",value:function(){this.setState(Object.assign({},this.state,{loadUrlDialogOpen:!1})),this.state.url&&(E("url_selected"),this.props.history.push({pathname:"/view",search:w.stringify({url:this.state.url})}))}},{key:"handleUrlChange",value:function(e){this.setState(Object.assign({},this.state,{url:e.target.value}))}},{key:"handleSearch",value:function(e){var t=this;if(e){var n=this.searchIndex.search(e).map(function(e){return function(e,t){return{id:e.id,title:De(e),description:Ie(e.indi,t)}}(e,t.context.intl)});this.setState(Object.assign({},this.state,{searchResults:n}))}}},{key:"handleResultSelect",value:function(e){this.props.onSelection({id:e,generation:0}),this.searchRef.setValue("")}},{key:"initializeSearchIndex",value:function(){var e;this.props.gedcom&&(this.searchIndex=(e=this.props.gedcom,new _e(e)))}},{key:"componentDidMount",value:function(){this.initializeSearchIndex()}},{key:"componentDidUpdate",value:function(e){e.gedcom!==this.props.gedcom&&this.initializeSearchIndex()}},{key:"render",value:function(){var e=this,t=i.createElement(Le.a,{open:this.state.loadUrlDialogOpen,onClose:function(){return e.handleClose()},centered:!1},i.createElement(Ne.a,null,i.createElement(Ue.a,{name:"cloud download"}),i.createElement(s.a,{id:"load_from_url.title",defaultMessage:"Load from URL",children:function(e){return e}})),i.createElement(Le.a.Content,null,i.createElement(Pe.a,{onSubmit:function(){return e.handleLoad()}},i.createElement(Ae.a,{placeholder:"https://",fluid:!0,onChange:function(t){return e.handleUrlChange(t)},ref:function(t){return e.inputRef=t}}),i.createElement("p",null,i.createElement(s.a,{id:"load_from_url.comment",defaultMessage:"Data from the URL will be loaded through {link} to avoid CORS issues.",values:{link:i.createElement("a",{href:"https://cors-anywhere.herokuapp.com/"},"cors-anywhere.herokuapp.com")}})))),i.createElement(Le.a.Actions,null,i.createElement(We.a,{secondary:!0,onClick:function(){return e.handleClose()}},i.createElement(s.a,{id:"load_from_url.cancel",defaultMessage:"Cancel"})),i.createElement(We.a,{primary:!0,onClick:function(){return e.handleLoad()}},i.createElement(s.a,{id:"load_from_url.load",defaultMessage:"Load"})))),n=this.props.showingChart?i.createElement(i.Fragment,null,i.createElement(Fe.a.Item,{as:"a",onClick:function(){return e.props.onPrint()}},i.createElement(Ue.a,{name:"print"}),i.createElement(s.a,{id:"menu.print",defaultMessage:"Print"})),i.createElement(Be.a,{trigger:i.createElement("div",null,i.createElement(Ue.a,{name:"download"}),i.createElement(s.a,{id:"menu.download",defaultMessage:"Download"})),className:"item"},i.createElement(Be.a.Menu,null,i.createElement(Be.a.Item,{onClick:function(){return e.props.onDownloadPdf()}},i.createElement(s.a,{id:"menu.pdf_file",defaultMessage:"PDF file"})),i.createElement(Be.a.Item,{onClick:function(){return e.props.onDownloadPng()}},i.createElement(s.a,{id:"menu.png_file",defaultMessage:"PNG file"})),i.createElement(Be.a.Item,{onClick:function(){return e.props.onDownloadSvg()}},i.createElement(s.a,{id:"menu.svg_file",defaultMessage:"SVG file"})))),i.createElement(Ge.a,{onSearchChange:ke()(function(t,n){return e.handleSearch(n.value)},200),onResultSelect:function(t,n){return e.handleResultSelect(n.result.id)},results:this.state.searchResults,noResultsMessage:this.context.intl.formatMessage({id:"menu.search.no_results",defaultMessage:"No results found"}),placeholder:this.context.intl.formatMessage({id:"menu.search.placeholder",defaultMessage:"Search for people"}),selectFirstResult:!0,ref:function(t){return e.searchRef=t}})):null;return i.createElement(Fe.a,{attached:"top",inverted:!0,color:"blue",size:"large"},i.createElement(me.a,{to:"/"},i.createElement(Fe.a.Item,null,i.createElement("b",null,"Topola Genealogy"))),i.createElement(Fe.a.Item,{as:"a",onClick:function(){return e.handleLoadFromUrl()}},i.createElement(Ue.a,{name:"cloud download"}),i.createElement(s.a,{id:"menu.load_from_url",defaultMessage:"Load from URL"})),i.createElement("input",{className:"hidden",type:"file",accept:".ged,image/*",id:"fileInput",multiple:!0,onChange:function(t){return e.handleUpload(t)}}),i.createElement("label",{htmlFor:"fileInput"},i.createElement(Fe.a.Item,{as:"a"},i.createElement(Ue.a,{name:"folder open"}),i.createElement(s.a,{id:"menu.load_from_file",defaultMessage:"Load from file"}))),n,i.createElement(Fe.a.Item,{as:"a",href:"https://github.com/PeWu/topola-viewer",position:"right",target:"_blank"},i.createElement(s.a,{id:"menu.github",defaultMessage:"Source on GitHub"})),t)}}]),t}(i.Component);function qe(e){return i.createElement(ge.a,{negative:!0,className:"error"},i.createElement(ge.a.Header,null,"Failed to load file"),i.createElement("p",null,e.message))}Je.contextTypes={intl:s.d};var Ke=function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={loading:!1},n.chartRef=null,n.onSelection=function(e){E("selection_changed");var t=n.props.location,a=w.parse(t.search);a.indi=e.id,a.gen=String(e.generation),t.search=w.stringify(a),n.props.history.push(t)},n.renderMainArea=function(){return n.state.data&&n.state.selection?i.createElement("div",{id:"content"},i.createElement(L,{data:n.state.data.chartData,onSelection:n.onSelection,selection:n.state.selection,ref:function(e){return n.chartRef=e}}),n.state.showSidePanel?i.createElement(ve.a,{minWidth:768,id:"sidePanel"},i.createElement(Q,{gedcom:n.state.data.gedcom,indi:n.state.selection.id})):null):n.state.error?i.createElement(qe,{message:n.state.error}):i.createElement(we.a,{active:!0,size:"large"})},n}return Object(v.a)(t,e),Object(h.a)(t,[{key:"isNewData",value:function(e,t){return!(!e||e===this.state.hash)||!(!t||this.state.url===t)}},{key:"componentDidMount",value:function(){this.componentDidUpdate()}},{key:"componentDidUpdate",value:function(){var e=Object(f.a)(d.a.mark(function e(){var t,n,a,r,o,i,l,c,s,u,f,m,h,p;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("/view"===this.props.location.pathname){e.next=2;break}return e.abrupt("return");case 2:if(t=this.props.location.state&&this.props.location.state.data,n=this.props.location.state&&this.props.location.state.images,a=w.parse(this.props.location.search),o=(r=function(e){var t=a[e];return"string"===typeof t?t:void 0})("url"),i=r("indi"),l=Number(r("gen")),c=isNaN(l)?void 0:l,s=r("file"),u="false"!==r("handleCors"),f="false"!==r("sidePanel"),o||s){e.next=17;break}this.props.history.replace({pathname:"/"}),e.next=42;break;case 17:if(!this.isNewData(s,o)){e.next=41;break}if(e.prev=18,this.setState(Object.assign({},this.state,{data:void 0,selection:void 0,hash:s,error:void 0,loading:!0,url:o})),!s){e.next=26;break}return e.next=23,ue(s,t,n);case 23:e.t0=e.sent,e.next=29;break;case 26:return e.next=28,ce(o,u);case 28:e.t0=e.sent;case 29:m=e.t0,h=oe(m.gedcom.head),E(s?"upload_file_loaded":"url_file_loaded",{event_label:h,event_value:n&&n.size||0}),this.setState(Object.assign({},this.state,{data:m,hash:s,selection:ie(m.chartData,i,c),error:void 0,loading:!1,url:o,showSidePanel:f})),e.next=39;break;case 35:e.prev=35,e.t1=e.catch(18),E(s?"upload_file_error":"url_file_error"),this.setState(Object.assign({},this.state,{error:e.t1.message,loading:!1}));case 39:e.next=42;break;case 41:this.state.data&&this.state.selection&&(p=ie(this.state.data.chartData,i,c),this.state.selection.id===p.id&&this.state.selection.generation===p.generation||this.setState(Object.assign({},this.state,{selection:p})));case 42:case"end":return e.stop()}},e,this,[[18,35]])}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return i.createElement(i.Fragment,null,i.createElement(Ee.a,{render:function(t){return i.createElement(Je,Object.assign({},t,{gedcom:e.state.data&&e.state.data.gedcom,showingChart:!("/view"!==e.props.history.location.pathname||!e.state.data||!e.state.selection),onSelection:e.onSelection,onPrint:function(){E("print"),e.chartRef&&e.chartRef.print()},onDownloadPdf:function(){E("download_pdf"),e.chartRef&&e.chartRef.downloadPdf()},onDownloadPng:function(){E("download_png"),e.chartRef&&e.chartRef.downloadPng()},onDownloadSvg:function(){E("download_svg"),e.chartRef&&e.chartRef.downloadSvg()}}))}}),i.createElement(ye.a,null,i.createElement(Ee.a,{exact:!0,path:"/",component:pe}),i.createElement(Ee.a,{exact:!0,path:"/view",render:this.renderMainArea}),i.createElement(be.a,{to:"/"})))}}]),t}(i.Component),Xe=n(277),Ze=n(534);n(510),n(511),n(512);Object(s.c)([].concat(Object(a.a)(r),Object(a.a)(o)));var Ye={pl:c},$e=navigator.language&&navigator.language.split(/[-_]/)[0],Qe=Object(Xe.detect)();Qe&&"ie"===Qe.name?l.render(i.createElement("p",null,"Topola Genealogy Viewer does not support Internet Explorer. Please try a different browser."),document.querySelector("#root")):l.render(i.createElement(s.b,{locale:$e,messages:Ye[$e]},i.createElement(Ze.a,null,i.createElement(Ee.a,{component:Ke}))),document.querySelector("#root"))}},[[289,1,2]]]);
//# sourceMappingURL=main.030b7a07.chunk.js.map