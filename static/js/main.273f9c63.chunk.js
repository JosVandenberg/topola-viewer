(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{223:function(e){e.exports={"menu.load_from_url":"Otw\xf3rz URL","menu.load_from_file":"Otw\xf3rz plik","menu.print":"Drukuj","menu.download":"Pobierz","menu.svg_file":"Plik SVG","menu.github":"\u0179r\xf3d\u0142a na GitHub","intro.title":"Topola Genealogy","intro.description":"Topola Genealogy pozwala przegl\u0105da\u0107 drzewo genealogiczne w interaktywny spos\xf3b.","intro.instructions":"Kliknij OTW\xd3RZ URL lub OTW\xd3RZ PLIK, aby za\u0142adowa\u0107 plik GEDCOM. Wi\u0119kszo\u015b\u0107 program\xf3w genealogicznych posiada funkcj\u0119 eksportu do pliku GEDCOM.","intro.examples":"Poni\u017cej jest kilka przyk\u0142ad\xf3w znalezionych w Internecie:","intro.from":"\u017ar\xf3d\u0142o:","intro.privacy":"Prywatno\u015b\u0107","intro.privacy_note":'U\u017cywaj\u0105c funkcji "Otw\xf3rz plik", Twoje dane nie s\u0105 nigdzie wysy\u0142ane i pozostaj\u0105 na Twoim komputerze. U\u017cywaj\u0105c funkcji "Otw\xf3rz URL", dane z podanego adresu przesy\u0142ane s\u0105 przez us\u0142ug\u0119 {link} w celu umo\u017cliwienia za\u0142adowania danych z innej domeny (CORS).',"load_from_url.title":"Otw\xf3rz z adresu URL","load_from_url.comment":"Dane z podanego adresu URL zostan\u0105 za\u0142adowane poprzez us\u0142ug\u0119 {link} w celu unikni\u0119cia problem\xf3w z CORS.","load_from_url.cancel":"Anuluj","load_from_url.load":"Otw\xf3rz"}},224:function(e,t){},260:function(e,t,n){e.exports=n(461)},272:function(e,t){},278:function(e,t){},455:function(e,t,n){},461:function(e,t,n){"use strict";n.r(t);var a=n(198),r=n(221),o=n(222),i=n(0),l=n(59),s=n(223),c=n(15),d=n(226),u=n(33),m=n(34),h=n(38),f=n(35),p=n(37),g=n(39),v=n(97),y=n.n(v),E=n(17),w=n(64);function b(){var e=E.select("#chart").node().parentElement;e.scrollLeft=-E.event.transform.x,e.scrollTop=-E.event.transform.y}function O(){var e=E.select("#chart").node().parentElement,t=e.scrollLeft+e.clientWidth/2,n=e.scrollTop+e.clientHeight/2;E.select(e).call(E.zoom().translateTo,t,n)}var k=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(h.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(r)))).chart=void 0,n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"renderChart",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{initialRender:!1};t.initialRender&&(E.select("#chart").node().innerHTML="",this.chart=Object(w.createChart)({json:this.props.data,chartType:w.HourglassChart,renderer:w.DetailedRenderer,svgSelector:"#chart",indiCallback:function(t){return e.props.onSelection(t)},animate:!0,updateSvgSize:!1,locale:this.context.intl.locale}));var n=this.chart.render({startIndi:this.props.selection.id,baseGeneration:this.props.selection.generation}),a=E.select("#chart"),r=a.node().parentElement;E.select(r).on("scroll",O).call(E.zoom().scaleExtent([1,1]).translateExtent([[0,0],n.size]).on("zoom",b));var o,i,l=r.clientWidth/2-n.origin[0],s=r.clientHeight/2-n.origin[1],c=E.max([0,(r.clientWidth-n.size[0])/2]),d=E.max([0,(r.clientHeight-n.size[1])/2]),u=a.transition().delay(200).duration(500);(t.initialRender?a:u).attr("transform","translate(".concat(c,", ").concat(d,")")).attr("width",n.size[0]).attr("height",n.size[1]),t.initialRender?(r.scrollLeft=-l,r.scrollTop=-s):u.tween("scrollLeft",(i=-l,function(){var e=E.interpolateNumber(r.scrollLeft,i);return function(t){r.scrollLeft=e(t)}})).tween("scrollTop",(o=-s,function(){var e=E.interpolateNumber(r.scrollTop,o);return function(t){r.scrollTop=e(t)}}))}},{key:"componentDidMount",value:function(){this.renderChart({initialRender:!0})}},{key:"componentDidUpdate",value:function(e){this.renderChart({initialRender:this.props.data!==e.data})}},{key:"render",value:function(){return i.createElement("div",{id:"svgContainer"},i.createElement("svg",{id:"chart"}))}},{key:"getSvgContents",value:function(){var e=document.getElementById("chart").cloneNode(!0);return e.removeAttribute("transform"),e.outerHTML}},{key:"print",value:function(){var e=this,t=document.createElement("iframe");t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.onload=function(){t.contentDocument.open(),t.contentDocument.write(e.getSvgContents()),t.contentDocument.close(),setTimeout(function(){t.contentWindow.focus(),t.contentWindow.print(),t.parentNode.removeChild(t)},500)},document.body.appendChild(t)}},{key:"downloadSvg",value:function(){var e=document.createElement("a");e.href=URL.createObjectURL(new Blob([this.getSvgContents()],{type:"image/svg+xml"})),e.target="_blank",e.download="topola.svg",e.click()}}]),t}(i.PureComponent);function j(e,t){if(!e.children)return e;var n=e.children.sort(function(e){var t=new Map;return e.indis.forEach(function(e){t[e.id]=e}),function(e,n){var a,r,o=(a=e)<(r=n)?-1:a>r?1:0,i=t[e],l=t[n],s=i&&i.birth,c=l&&l.birth,d=s&&(s.date||s.dateRange&&s.dateRange.from),u=c&&(c.date||c.dateRange&&c.dateRange.from);return d&&d.year&&u&&u.year?d.year!==u.year?d.year-u.year:d.month&&u.month?d.month!==u.month?d.month-u.month:d.day&&u.day&&d.day!==u.day?d.month-u.month:o:o:o}}(t));return Object.assign({},e,{children:n})}function C(e){if(!e.imageUrl||e.imageUrl.startsWith("http"))return e;var t=Object.assign({},e);return delete t.imageUrl,t}function S(e){var t=Object(w.gedcomToJson)(e);if(!t||!t.indis||!t.indis.length||!t.fams||!t.fams.length)throw new Error("Failed to read GEDCOM file");return function(e){var t=e.indis.map(C);return Object.assign({},e,{indis:t})}(function(e){var t=e.fams.map(function(t){return j(t,e)});return Object.assign({},e,{fams:t})}(t))}k.contextTypes={intl:c.d};var z=n(478),R=n(470);function U(e){return i.createElement(z.a,{negative:!0,className:"error"},i.createElement(z.a.Header,null,"Failed to load file"),i.createElement("p",null,e.message))}function _(e,t,n){return{id:t||e.indis[0].id,generation:n||0}}var L=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(h.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(r)))).state={loading:!1},n.chartRef=null,n.onSelection=function(e){var t=n.props.location,a=g.parse(t.search);a.indi=e.id,a.gen=String(e.generation),t.search=g.stringify(a),n.props.history.push(t)},n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"loadFromUrl",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=sessionStorage.getItem(e);if(a){var r=JSON.parse(a);this.setState(Object.assign({},this.state,{data:r,selection:_(r,n.indi,n.generation),loadedUrl:e,loading:!1,error:void 0,hash:void 0}))}else{this.setState(Object.assign({},this.state,{loading:!0,loadedUrl:e,data:void 0,error:void 0}));var o=n.handleCors?"https://cors-anywhere.herokuapp.com/"+e:e;window.fetch(o).then(function(e){return 200!==e.status?Promise.reject(new Error(e.statusText)):e.text()}).then(function(a){return t.setGedcom({gedcom:a,url:e,indi:n.indi,generation:n.generation})}).catch(function(e){return t.setState(Object.assign({},t.state,{error:e.message,loading:!1}))})}}},{key:"setGedcom",value:function(e){var t=y()(e.gedcom);try{var n=S(e.gedcom),a=JSON.stringify(n);sessionStorage.setItem(e.url||t,a),this.setState(Object.assign({},this.state,{data:n,selection:_(n,e.indi,e.generation),hash:t,loading:!1,loadedUrl:e.url,error:void 0}))}catch(r){this.setState(Object.assign({},this.state,{data:void 0,selection:void 0,hash:t,loading:!1,error:"Failed to read GEDCOM file",loadedUrl:e.url}))}}},{key:"componentDidMount",value:function(){this.componentDidUpdate()}},{key:"componentDidUpdate",value:function(){var e=this.props.location.state&&this.props.location.state.data,t=g.parse(this.props.location.search),n=function(e){var n=t[e];return"string"===typeof n?n:void 0},a=n("url"),r=n("indi"),o=Number(n("gen")),i=isNaN(o)?void 0:o,l=n("file"),s="false"!==n("handleCors");if(l&&l!==this.state.hash)if(e)this.setGedcom({gedcom:e,indi:r,generation:i});else{var c=sessionStorage.getItem(l);if(c){var d=JSON.parse(c);this.setState(Object.assign({},this.state,{data:d,hash:l,selection:_(d,r,i),error:void 0,loading:!1,loadedUrl:void 0}))}else this.props.history.replace({pathname:"/"})}else if(!this.state.loading&&a&&this.state.loadedUrl!==a)this.loadFromUrl(a,{indi:r,generation:i,handleCors:a.startsWith("http")&&s});else if(a||e||l===this.state.hash){if(this.state.data&&this.state.selection){var u=_(this.state.data,r,i);this.state.selection.id===u.id&&this.state.selection.generation===u.generation||this.setState(Object.assign({},this.state,{selection:u}))}}else this.props.history.replace({pathname:"/"})}},{key:"render",value:function(){var e=this;return this.state.data&&this.state.selection?i.createElement(k,{data:this.state.data,onSelection:this.onSelection,selection:this.state.selection,ref:function(t){return e.chartRef=t}}):this.state.error?i.createElement(U,{message:this.state.error}):i.createElement(R.a,{active:!0,size:"large"})}},{key:"print",value:function(){this.chartRef&&this.chartRef.print()}},{key:"downloadSvg",value:function(){this.chartRef&&this.chartRef.downloadSvg()}}]),t}(i.Component),M=n(481),D=n(485),x=n(484),T=n(477),G=n(471);function I(e){return i.createElement(G.a,{to:{pathname:"/view",search:g.stringify({url:e.url})}},e.text)}var N=n(475),P=n(482),F=n(220),W=n(474),H=n(473),A=n(480),J=n(479),V=n(476),K=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(h.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(r)))).state={loadUrlDialogOpen:!1},n.inputRef=void 0,n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"handleUpload",value:function(e){var t=this,n=e.target.files;if(n&&n.length){var a=new FileReader;a.onload=function(e){var n=e.target.result,a=y()(n);t.props.history.push({pathname:"/view",search:g.stringify({file:a}),state:{data:n}})},a.readAsText(n[0])}}},{key:"handleLoadFromUrl",value:function(){var e=this;this.setState(Object.assign({},this.state,{loadUrlDialogOpen:!0}),function(){return e.inputRef.focus()})}},{key:"handleClose",value:function(){this.setState(Object.assign({},this.state,{loadUrlDialogOpen:!1}))}},{key:"handleLoad",value:function(){this.setState(Object.assign({},this.state,{loadUrlDialogOpen:!1})),this.state.url&&this.props.history.push({pathname:"/view",search:g.stringify({url:this.state.url})})}},{key:"handleUrlChange",value:function(e){this.setState(Object.assign({},this.state,{url:e.target.value}))}},{key:"render",value:function(){var e=this,t=i.createElement(N.a,{open:this.state.loadUrlDialogOpen,onClose:function(){return e.handleClose()},centered:!1},i.createElement(P.a,null,i.createElement(F.a,{name:"cloud download"}),i.createElement(c.a,{id:"load_from_url.title",defaultMessage:"Load from URL",children:function(e){return e}})),i.createElement(N.a.Content,null,i.createElement(W.a,{onSubmit:function(){return e.handleLoad()}},i.createElement(H.a,{placeholder:"https://",fluid:!0,onChange:function(t){return e.handleUrlChange(t)},ref:function(t){return e.inputRef=t}}),i.createElement("p",null,i.createElement(c.a,{id:"load_from_url.comment",defaultMessage:"Data from the URL will be loaded through {link} to avoid CORS issues.",values:{link:i.createElement("a",{href:"https://cors-anywhere.herokuapp.com/"},"cors-anywhere.herokuapp.com")}})))),i.createElement(N.a.Actions,null,i.createElement(A.a,{secondary:!0,onClick:function(){return e.handleClose()}},i.createElement(c.a,{id:"load_from_url.cancel",defaultMessage:"Cancel"})),i.createElement(A.a,{primary:!0,onClick:function(){return e.handleLoad()}},i.createElement(c.a,{id:"load_from_url.load",defaultMessage:"Load"}))));return i.createElement(J.a,{attached:"top",inverted:!0,color:"blue",size:"large"},i.createElement(G.a,{to:"/"},i.createElement(J.a.Item,null,i.createElement("b",null,"Topola Genealogy"))),i.createElement(J.a.Item,{as:"a",onClick:function(){return e.handleLoadFromUrl()}},i.createElement(F.a,{name:"cloud download"}),i.createElement(c.a,{id:"menu.load_from_url",defaultMessage:"Load from URL"})),i.createElement("input",{className:"hidden",type:"file",accept:".ged",id:"fileInput",onChange:function(t){return e.handleUpload(t)}}),i.createElement("label",{htmlFor:"fileInput"},i.createElement(J.a.Item,{as:"a"},i.createElement(F.a,{name:"folder open"}),i.createElement(c.a,{id:"menu.load_from_file",defaultMessage:"Load from file"}))),i.createElement(J.a.Item,{as:"a",onClick:function(){return e.props.onPrint()}},i.createElement(F.a,{name:"print"}),i.createElement(c.a,{id:"menu.print",defaultMessage:"Print"})),i.createElement(V.a,{trigger:i.createElement("div",null,i.createElement(F.a,{name:"download"}),i.createElement(c.a,{id:"menu.download",defaultMessage:"Download"})),className:"item"},i.createElement(V.a.Menu,null,i.createElement(V.a.Item,{onClick:function(){return e.props.onDownloadSvg()}},i.createElement(c.a,{id:"menu.svg_file",defaultMessage:"SVG file"})))),i.createElement(J.a.Item,{as:"a",href:"https://github.com/PeWu/topola-viewer",position:"right"},i.createElement(c.a,{id:"menu.github",defaultMessage:"Source on GitHub"})),t)}}]),t}(i.Component);n(455),n(457);Object(c.c)([].concat(Object(a.a)(r),Object(a.a)(o)));var q={pl:s},B=navigator.language&&navigator.language.split(/[-_]/)[0],Z=Object(d.detect)(),Y=null;Z&&"ie"===Z.name?l.render(i.createElement("p",null,"Topola Genealogy Viewer does not support Internet Explorer. Please try a different browser."),document.querySelector("#root")):l.render(i.createElement(c.b,{locale:B,messages:q[B]},i.createElement(M.a,null,i.createElement("div",{className:"root"},i.createElement(D.a,{component:function(e){return i.createElement(K,Object.assign({},e,{onPrint:function(){return Y&&Y.print()},onDownloadSvg:function(){return Y&&Y.downloadSvg()}}))}}),i.createElement(x.a,null,i.createElement(D.a,{exact:!0,path:"/",component:function(){return i.createElement(T.a,{className:"intro"},i.createElement(T.a.Content,null,i.createElement(T.a.Header,null,i.createElement(c.a,{id:"intro.title",defaultMessage:"Topola Genealogy Viewer"}))),i.createElement(T.a.Content,null,i.createElement("p",null,i.createElement(c.a,{id:"intro.description",defaultMessage:"Topola Genealogy is a genealogy tree viewer that lets you browse the structure of the family."})),i.createElement("p",null,i.createElement(c.a,{id:"intro.instructions",defaultMessage:"Use the LOAD FROM URL or LOAD FROM FILE buttons above to load a GEDCOM file. You can export a GEDCOM file from most of the existing genealogy programs and web sites."})),i.createElement("p",null,i.createElement(c.a,{id:"intro.examples",defaultMessage:"Here are some examples from the web that you can view:"})),i.createElement("ul",null,i.createElement("li",null,i.createElement(I,{url:"http://genpol.com/module-Downloads-prep_hand_out-lid-32.html",text:"Karol Wojty\u0142a"})," ","(",i.createElement(c.a,{id:"intro.from",defaultMessage:"from"})," ",i.createElement("a",{href:"http://genpol.com/module-Downloads-display-lid-32.html"},"GENPOL"),")"),i.createElement("li",null,i.createElement(I,{url:"https://webtreeprint.com/tp_downloader.php?path=famous_gedcoms/shakespeare.ged",text:"Shakespeare"})," ","(",i.createElement(c.a,{id:"intro.from",defaultMessage:"from"})," ",i.createElement("a",{href:"https://webtreeprint.com/tp_famous_gedcoms.php"},"webtreeprint.com"),")"),i.createElement("li",null,i.createElement(I,{url:"http://genealogyoflife.com/tng/gedcom/HarryPotter.ged",text:"Harry Potter"})," ","(",i.createElement(c.a,{id:"intro.from",defaultMessage:"from"})," ",i.createElement("a",{href:"http://famousfamilytrees.blogspot.com/"},"Famous Family Trees"),")")),i.createElement("p",null,i.createElement("b",null,i.createElement(c.a,{id:"intro.privacy",defaultMessage:"Privacy"})),":",i.createElement(c.a,{id:"intro.privacy_note",defaultMessage:'When using the "load from file" option, this site does not send your data anywhere and files loaded from disk do not leave your computer. When using "load from URL", data is passed through the {link} service to deal with an issue with cross-site file loading in the browser (CORS).',values:{link:i.createElement("a",{href:"https://cors-anywhere.herokuapp.com/"},"cors-anywhere")}}))))}}),i.createElement(D.a,{exact:!0,path:"/view",component:function(e){return i.createElement(L,Object.assign({},e,{ref:function(e){return Y=e}}))}}))))),document.querySelector("#root"))}},[[260,2,1]]]);
//# sourceMappingURL=main.273f9c63.chunk.js.map